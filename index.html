<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Weather Dashboard</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    
</head>
<body>
<!-- hero -->
    <section class="hero is-dark">
        <div class="hero-body">
            <div class="container">
                <h1 class="title is-1">My Weather <br> Dashboard</h1>
            </div>
        </div>
    </section>

<!-- CITY SEARCH HERE -->
<div class="columns is-ancestor" style="margin: 1px 25px;">
        <div class="column is-vertical is-3">
            <div class="card">
                <div class="card-content">
                    <h2 class="title" style="text-align: center;">Your Cities</h2>
                    <div class="card-footer-item">
                        <button class="button is-link" id="newSearchBtn">New Search</button>
                    </div>
                </div>
                <footer class="card-footer">
                    <div id="cityResults" class="column">
                    <!-- search results here -->
                    
                    <!-- search results here -->            
                    </div>
                </footer>

            </div>
        </div>
        <div class="column  is-vertical is-9">
            <div class="card">
                <div class="card-content">
                    <h1 class="title" id="currentDay"></h1>
                    <h1 class="subtitle is-4" id="currentTime"></h1>
                </div>
                <footer class="card-footer">
                    <!-- create divs and data with jQuery? -->
                    <div class="card-footer-item" id="day1">
                        
                    </div>
                    <div class="card-footer-item" id="day2">
                        
                    </div>

                    <div class="card-footer-item" id="day3">
                        
                    </div>
                    <div class="card-footer-item" id="day4">
                        
                    </div>
                    <div class="card-footer-item" id="day5">
                        
                    </div>
                </footer>
            </div>
        </div>
</div>
<!-- MODAL GOES BELOW -->
<div class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Enter a city name below</p>
        <button class="delete" aria-label="close"></button>
      </header>
      <section class="modal-card-body">
        <input type="text" id="cityValue">
      </section>
      <footer class="modal-card-foot">
        <button id="showResults" class="button is-success">Show my results!</button>
      </footer>
    </div>
  </div>

<footer class="footer">
    <div class="content has-text-centered">
      <p>
        <strong>My Weather Dashboard</strong> by <a href="https://www.linkedin.com/in/pralburco/" target="_blank">Pedro Alburqueque</a>
        <br> Check out my GitHub <a href="https://github.com/prolsu" target="_blank">here.</a>
      </p>
    </div>
  </footer>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script>

    $(document).ready(function(){
            
        $("#currentDay").text(moment().format("dddd, MMMM Do"));
        $("#currentTime").text(moment().format("hh:mm A"));
        
        //this for loop displays cities searched on main page...
        for (var i = 0; i < localStorage.length; i++){
            var storedCities = "city"+ i;
            var myStoredCity = localStorage.getItem(storedCities);
            var cityNewElement = $("<h1 class='city button column is-light' style='margin-bottom:2.5px' value='" + myStoredCity + "'>" + myStoredCity + "</h1>");
            $("#cityResults").prepend(cityNewElement);
        }
        
        // new search button displays modal so user can enter a city...
        $("#newSearchBtn").on("click", function(){

            $(".modal").attr("style", "display: ;");
            $(".modal").addClass("is-active");
            $(".modal").addClass("open"); 
        });

        $("#showResults").on("click", function(){

            // $("#searchBox").attr("display","");
            var city = $("#cityValue").val().trim();//city query goes here...
            
            if (city !== ""){
                // takes user input and adds it to the URL
                $(".warning").text("");
                $(".modal").attr("style", "display: none;");
                $("#cityValue").val("");
            }
            if (city == "") {
                $(".warning").text("");
                var searchEmpty = $("<p>Search box can't be empty</p>")
                searchEmpty.addClass("warning")
                $(".modal-card-foot").append(searchEmpty);
            }
            // creates new button element with the city as value
            var cityNewElement = $("<h1 class='city button column is-light' style='margin-bottom:2.5px' value='" + city + "'>" + city + "</h1>");
            $("#cityResults").prepend(cityNewElement);

            // city is stored under a key named "city" followed by the length of cities stored as a number i.e: "city0"
            var cityNumber = localStorage.length;
            var cities = "city" + cityNumber
            localStorage[cities] = city;
            
        });
        
        $(".delete").on("click", function(){
            $(".warning").text("");
            $(".modal").attr("style", "display: none;");
            $(".modal").removeClass("open");
        });

        while ($(".modal").hasClass("open") === true){
            $(window).on("click", console.log("test"))
        }

        $(".city").on("click",function(event){
            event.preventDefault();

            var cityQ = $(this).text();
            var queryURL = "https://api.openweathermap.org/data/2.5/forecast?q="+ cityQ +"&appid=717dd06b31c62671b1b64ddb918b4117";

            $.ajax({
                url: queryURL,
                method: "GET"
            }).then(function(weatherResults){
                console.log(queryURL);
                console.log(weatherResults);
            })
        })

    });

    </script>
    
</body>
</html>